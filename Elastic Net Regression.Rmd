---
title: "Elastic Net Regression"
author: "D. Nick Weber"
date: "5/11/2021"
output: html_document
---

#Elastic net regression at an alpha of 0.5.

```{r}
#In the below cv.glmnet function, "x" represents a matrix of percent methylation values at each site and in each sample; "y" represents a vector of chronological ages associated with each sample. 

MAEs <- NULL 

for (i in 1:100){
                 cv <- cv.glmnet(x = x, y = y, alpha = 0.5, nfolds = 10, type.measure="mae", family="gaussian", standardize=FALSE)  
                 MAEs <- cbind(MAEs, cv$cvm)
}

  MAEs <- data.frame(MAEs)
  rownames(MAEs) <- cv$lambda
  MAEs <- setDT(MAEs, keep.rownames = "lambda")[]
  MAEs$mean.mae <- rowMeans(MAEs[ ,c(2:101)])
  lambda.min <- min(MAEs$lambda)
  min.mae <- min(MAEs$mean.mae)

plot(cv)

#Get no. of CpG sites selected by the elastic net model
coefList <- coef(cv, s=cv$lambda.min)
coefList <- data.frame(coefList@Dimnames[[1]][coefList@i+1],coefList@x)
names(coefList) <- c('var','val')
coefList <- coefList[-1, ]
nrow(coefList)

#Make age predictions using final model
y_hat_enet <- predict(cv, newx=x, s="lambda.min")
```
